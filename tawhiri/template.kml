{#- Copyright 2014 Jon Sowman, Daniel Richman -#}
{#- Copyright 2016 Adam Greig -#}
{%- autoescape true -%}
<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2">
    <Document>
        <name>Tawhiri Prediction</name>
        <Style id="yellowPoly">
            <LineStyle>
                <color>7f00ffff</color>
                <width>4</width>
            </LineStyle>
            <PolyStyle>
                <color>7f00ff00</color>
            </PolyStyle>
        </Style>
        {% for prediction in predictions %}
        <Folder>
            <name>Prediction {{ loop.index }}</name>
            {% for stage in prediction.prediction %}
            {% if stage.type == "event" %}
            <Placemark>
                <name>{{ stage.stage }}</name>
                <Point>
                    <coordinates>{{ stage.longitude }},{{ stage.latitude }},{{ stage.altitude }}</coordinates>
                    <altitudeMode>absolute</altitudeMode>
                </Point>
            </Placemark>
            {% elif stage.type == "path" %}
            <LineString>
                <extrude>1</extrude>
                <tesselate>1</tesselate>
                <altitudeMode>absolute</altitudeMode>
                <styleUrl>#yellowPoly</styleUrl>
                <coordinates>
                    {% for point in stage["path"] %}
                    {{ point.longitude }},{{ stage.latitude }},{{ stage.altitude }}
                    {% endfor %}
                </coordinates>
            </LineString>
            {% endif %}
            {% endfor %}
        </Folder>
        {% endfor %}
    </Document>
</kml>
{% endautoescape %}
